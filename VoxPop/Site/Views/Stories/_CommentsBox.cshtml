@model List<Site.Storage.Models.CommentEntity>
@Styles.Render("~/Content/css")

@section MetaTags
{
    @Html.Partial("_DefaultMetaTags")
}

@{
    Layout = "";
}

@if (@Model.Select(x => x.PollOptionKey).Count() != 0)
{

    <h1 class="comment-box-title">Voter Comments</h1>

    if (Model.Select(x => x.PollOptionKey).Distinct().Count() <= 2)
    {
        var Op1 = Model.Select(x => x.PollOptionKey).Distinct().First();
        var decodedOp1 = HttpUtility.UrlDecode(Op1);
        var Op2 = Model.Select(x => x.PollOptionKey).Distinct().Last();
        var decodedOp2 = HttpUtility.UrlDecode(Op2);

        <div class="comment-box-sbs-1">
            <h3>People who voted for @decodedOp1 say:</h3>
            @foreach (var voteComment in Model)
            {
                if (@voteComment.PollOptionKey == Op1)
                {
                    <h3>@Html.ActionLink(voteComment.Commenter, "AuthorStories", new { Auth = @voteComment.CommenterUsername }, null)</h3> @voteComment.Timestamp.ToString("g")
                    <p style="white-space:pre-wrap;">@voteComment.Comment</p>
                }
            }
        </div>
        if (Model.Select(x => x.PollOptionKey).Distinct().Count() > 1)
        {
            <div class="comment-box-sbs-2">
                <h3>People who voted for @decodedOp2 say:</h3>
                @foreach (var voteComment in Model)
                {
                    if (voteComment.PollOptionKey == Op2)
                    {
                        <h3>@Html.ActionLink(@voteComment.Commenter, "AuthorStories", new { Auth = @voteComment.CommenterUsername }, null)</h3> @voteComment.Timestamp.ToString("g")
                        <p style="white-space:pre-wrap;">@voteComment.Comment </p>
                    }
                }
            </div>
        }
    }
    else
    {
        foreach (var voteComment in Model)
        {
            var decodedOp = HttpUtility.UrlDecode(voteComment.PollOptionKey);
            <h5>@Html.ActionLink(@voteComment.Commenter, "AuthorStories", new { Auth = @voteComment.CommenterUsername }, null) voted @decodedOp</h5>
            <h6>@voteComment.Timestamp.ToString("g")</h6>
            <p style="white-space:pre-wrap;">@voteComment.Comment</p>
        }
    }
}
